webpackJsonp([3],{BUGv:function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var c=s("3cXf"),e=s.n(c),a={data:function(){return{msg:"这个是领取原材料列表页",currentPage:1,pageSize:10,total:0,totalPick:0,dialogPickConfirm:!1,dialogPickSuccess:!1,searchMsg:null,result:null,pickSelect:[],submitProduct:[],isEmpty:!1,showPage:!1}},methods:{turnStyleNum:function(t){return 0==t?"":t},toMaterialList:function(){this.$router.push({path:"/materialList"})},clearSelectProduct:function(){this.pickSelect=[],this.submitProduct=[]},searchPro:function(t){this.$emit("controLoading",!0),t&&(this.currentPage=1==t?t:this.currentPage,this.clearSelectProduct());var i={currentPage:this.currentPage,pageSize:this.pageSize};null!=this.searchMsg&&""!=this.searchMsg&&(/^[0-9]*$/.test(this.searchMsg)?i.productSn=this.searchMsg:i.productName=this.searchMsg),this.getData(i)},pickProduct:function(t,i){t.productNum=0==t.productNum?1:t.productNum;var s=1==i?this.pickSelect:this.submitProduct;if(-1!=e()(s).indexOf(e()(t))){for(var c=0;c<=s.length;c++)if(s[c].productId==t.productId)return s.splice(c,1),!1}else s.push(t);1==i?this.pickSelect=s:this.submitProduct=s},pickConfirm:function(){0!=this.pickSelect.length?(this.submitProduct=this.$deepCopy(this.pickSelect),this.dialogPickConfirm=!0):this.$emit("showError","请选择需要领取的商品！")},submitConfirm:function(){if(this.$emit("controLoading",!0),0!=this.submitProduct.length){for(var t=[],i=e()(this.submitProduct),s=0;s<this.pickSelect.length;s++)-1!=i.indexOf(this.pickSelect[s].productSn)&&(this.totalPick+=this.pickSelect[s].productNum,t.push(this.pickSelect[s]));var c={jsonString:e()(t)};this.confirmPick(c)}else this.$emit("showError","请至少选择一样商品！")},onChangeNumber:function(t,i,s){s.productNum=t},pageChange:function(t){this.currentPage=t,this.searchPro()},getData:function(t){var i=this;this.$httpExt().post("materials/getUsableList",t).then(function(t){i.result=t,i.total=t.totalRecord},function(t){i.$emit("showError",t.errorCode+":"+t.errorMsg)}).then(function(t){i.$emit("controLoading",!1)})},confirmPick:function(t){var i=this;this.$httpExt().post("materials/confirmPick",t).then(function(t){i.dialogPickConfirm=!1,i.dialogPickSuccess=!0},function(t){i.dialogPickConfirm=!1,i.$emit("showError","领取原材料失败",t.errorCode+":"+t.errorMsg)}).then(function(t){i.$emit("controLoading",!1),i.clearSelectProduct()})}},watch:{result:function(t,i){null!=t&&t.data.length>0?(this.isEmpty=!1,this.showPage=!0):(this.isEmpty=!0,this.showPage=!1)}},props:["partnerInfo"],mounted:function(){this.pageChange(1)}},n={render:function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("div",{staticClass:"c64 top-bot position-relative"},[t._v("\n\n        门店共有以下"),s("strong",{staticClass:"cblack"},[t._v(t._s(t.total)+"款")]),t._v(" 商品可以作为原材料领取并制作商品    \n        "),s("div",{staticClass:"position-absolute header-search-wrap"},[s("st-input",{staticStyle:{width:"300px"},attrs:{placeholder:"可输入商品编码/名称进行查询"},model:{value:t.searchMsg,callback:function(i){t.searchMsg=i},expression:"searchMsg"}},[s("st-button",{staticClass:"st-button",attrs:{slot:"append",type:"ss"},on:{click:function(i){t.searchPro(1)}},slot:"append"},[t._v("查询")])],1)],1),t._v(" "),s("st-button",{staticClass:"position-absolute product-header-btn-blue",attrs:{size:"xxl"},on:{click:t.pickConfirm}},[t._v(t._s(t.turnStyleNum(t.pickSelect.length))+"确认领取")])],1),t._v(" "),s("div",{staticClass:"ui-plist clearfix"},[null!=t.result?s("ul",t._l(t.result.data,function(i){return s("li",{key:i.index,class:{selected:-1!=JSON.stringify(t.pickSelect).indexOf(JSON.stringify(i))}},[s("div",{staticClass:"ui-pitem"},[s("div",{staticClass:"ui-pimg",on:{click:function(s){t.pickProduct(i,1)}}},[s("img",{attrs:{src:i.productImageMiddle}})]),t._v(" "),s("div",{staticClass:"ui-pname f14",on:{click:function(s){t.pickProduct(i,1)}}},[t._v(t._s(i.productName))]),t._v(" "),s("div",{staticClass:"ui-pmoney",on:{click:function(s){t.pickProduct(i,1)}}},[s("span",{staticClass:"ui-price"},[s("strong",{staticClass:"cred"},[t._v("￥"+t._s((i.productPrice/100).toFixed(0))+"."),s("small",[t._v(t._s((i.productPrice/100).toFixed(2).substring((i.productPrice/100).toFixed(2).indexOf(".")+1)))])])]),t._v(" "),s("p",{staticClass:"f12 c96"},[t._v("商品编码："+t._s(i.productSn))])]),t._v(" "),s("div",{staticClass:"ui-num-box clearfix "},[s("span",{staticClass:"fl ui-num-txt c64"},[t._v("领取数量")]),t._v(" "),s("div",{staticClass:"ui-num clearfix fl text-center"},[s("div",{staticClass:"fl"},[s("st-input-number",{attrs:{obj:i,min:1,max:i.productStock,mintip:"",maxtip:"已达到最大库存数量","parent-num":i.productNum,direction:"up"},on:{"change-number":t.onChangeNumber}})],1)])]),t._v(" "),s("div",{staticClass:"ui-pinfo clearfix",on:{click:function(s){t.pickProduct(i,1)}}},[s("span",{staticClass:"fl ui-num-txt c64"},[t._v("门店库存")]),t._v(" "),s("div",{staticClass:"ui-num clearfix fl text-center c32"},[t._v("\n                            "+t._s(i.productStock)+"\n                        ")])])]),t._v(" "),0==i.productStock?s("div",{staticClass:"mask"}):t._e()])})):t._e()]),t._v(" "),t.showPage?[s("st-pagenation",{attrs:{currentPage:t.currentPage,size:t.pageSize,total:t.total},on:{pagechange:t.pageChange}})]:t._e(),t._v(" "),s("st-dialog",{attrs:{title:"确认领取以下原材料吗？",width:"50%",visible:t.dialogPickConfirm,center:""},on:{"update:visible":function(i){t.dialogPickConfirm=i}}},[s("p",{staticClass:"c96 make-instruction-text"},[t._v("请按需选择，拒绝浪费，确认选择后原材料将从门店库存扣除")]),t._v(" "),s("div",{staticClass:"select-tz-wrap"},[s("div",{staticClass:"mainlist-h clearfix"},[s("div",{staticClass:"mainlist-h1 c96",staticStyle:{width:"60%"}},[s("span",[t._v("原材料名称")])]),t._v(" "),s("div",{staticClass:"mainlist-h2 c96 text-center",staticStyle:{width:"20%"}},[s("span",[t._v("门店在售库存")])]),t._v(" "),s("div",{staticClass:"mainlist-h4 c96 text-center",staticStyle:{width:"20%"}},[s("span",[t._v("需领取数量")])])]),t._v(" "),t._l(t.pickSelect,function(i){return s("div",{key:i.index},[s("div",{staticClass:"main-list main-list-space"},[s("i",{staticClass:"table-select position-absolute",class:{selected:-1!=JSON.stringify(t.submitProduct).indexOf(JSON.stringify(i.productId))}}),t._v(" "),s("div",{staticClass:"mainlist-con1 clearfix group-list",staticStyle:{width:"60%"},on:{click:function(s){t.pickProduct(i,2)}}},[s("div",{staticClass:"border-t clearfix list-info"},[s("img",{staticClass:"fl p-img",attrs:{src:i.productImageMiddle}}),t._v(" "),s("div",{staticClass:"fl p-info"},[s("div",{staticClass:"p-name f14"},[t._v(t._s(i.productName))]),t._v(" "),s("div",{staticClass:"c96"},[s("strong",{staticClass:"cred"},[t._v("￥"+t._s((i.productPrice/100).toFixed(2)))])])])])]),t._v(" "),s("div",{staticClass:"mainlist-con3 c32 text-center",staticStyle:{width:"20%"}},[t._v(t._s(i.productStock))]),t._v(" "),s("div",{staticClass:"mainlist-con4 text-center",staticStyle:{width:"20%"}},[s("div",{staticClass:"display-inlineblock"},[s("div",{staticClass:"ui-num clearfix fl text-center"},[s("div",{staticClass:"fl"},[s("st-input-number",{attrs:{obj:i,min:1,max:i.productStock,mintip:"",maxtip:"已达到最大库存数量","parent-num":i.productNum,direction:"down"},on:{"change-number":t.onChangeNumber}})],1)])])])])])})],2),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("st-button",{attrs:{size:"m"},on:{click:t.submitConfirm}},[t._v("确认领取")])],1)]),t._v(" "),s("st-notification",{attrs:{width:"40%",visible:t.dialogPickSuccess},on:{"update:visible":function(i){t.dialogPickSuccess=i},close:t.toMaterialList}},[s("div",{staticClass:"pop-suc-box clearfix"},[s("i",{staticClass:"fl icon-zcp-suc"}),t._v(" "),s("div",{staticClass:"fl"},[s("p",{staticClass:"c32 f24"},[t._v("原材料领取成功！")]),t._v(" "),s("p",{staticClass:"c96 tips"},[t._v("\n                    原材料领取记录已经生成，领取的原材料将从门店库存中扣除。"),s("br"),t._v(" 请及时从货架上将已经领取的原材料，搬运到制作区域。\n                ")]),t._v(" "),s("div",{staticClass:"c64 f16 save-text-box",staticStyle:{"padding-top":"20px"}},[s("p",{staticClass:"clearfix"},[s("span",{staticClass:"fl"},[t._v("领取总数量："+t._s(t.totalPick)+"件")]),t._v(" "),null!=t.partnerInfo?s("span",{staticClass:"fr save-text-right"},[t._v("操作人："+t._s(t.partnerInfo.userCode))]):t._e()]),t._v(" "),s("p",[t._v("领取时间："+t._s(t.$changeDateToString((new Date).getTime()/1e3)))])])])])]),t._v(" "),t.isEmpty?s("div",{staticClass:"search-null text-center"},[t._m(0),t._v(" "),s("div",{staticClass:"text-center f14 c32"},[t._v("门店暂无可领取原材料")])]):t._e()],2)},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"img"},[i("span",{staticClass:"icon"})])}]};var r=s("Z0/y")(a,n,!1,function(t){s("HNPv")},"data-v-5af15780",null);i.default=r.exports},HNPv:function(t,i){}});